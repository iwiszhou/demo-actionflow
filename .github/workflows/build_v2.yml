name: DEV or UAT Deployment

on:
  workflow_dispatch:
    inputs:
      eastype:
        type: choice
        description: Choose eas update or build
        required: true
        options:
          - update
          - build

jobs:
  deploy:
    if: github.ref == 'refs/heads/dev' || github.ref == 'refs/heads/uat' # Run only on dev or uat branches
    runs-on: ubuntu-latest

    steps:
      - name: 🏗 Setup repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Fetch all history to ensure we can reference HEAD^

      - name: 📦 Install dependencies
        run: yarn install

      - name: Check selected option
        run: echo "Selected option: ${{ github.event.inputs.eastype }}"

      - name: 🚀 Expo Build
        if: github.event.inputs.eastype == 'build'
        run: |
          yarn update-version-trigger-build:uat
          git add app.json versioning.json .env-cmdrc
          git commit -m "update version number in app.json"
          git push
          yarn build:uat

      - name: 🚀 Expo Update
        if: github.event.inputs.eastype == 'update'
        run: yarn update:uat
