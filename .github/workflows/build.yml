on:
  push:
    branches:
      - uat

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: 🏗 Setup repo
        uses: actions/checkout@v3
        with:
          fetch-depth: 0 # Fetch all history to ensure we can reference HEAD^

      - name: Check for app.json changes
        run: |
          # Fetch all branches and history
          git fetch --all

          # Check if app.json has been changed in the last commit
          if git diff HEAD^ HEAD --name-only | grep 'app.json'; then
            echo "app.json file has been changed."

            # Check if the version field has been modified in app.json
            if git diff HEAD^ HEAD -- app.json | grep '"version"'; then
              echo "The version field in app.json has been modified."
              VERSION_CHANGED=true
            else
              echo "The version field in app.json has NOT been modified."
              VERSION_CHANGED=false
            fi
          else
            echo "app.json file has NOT been changed."
            VERSION_CHANGED=false
          fi

          # Set the VERSION_CHANGED variable in the GitHub environment for later use
          echo "VERSION_CHANGED=$VERSION_CHANGED" >> $GITHUB_ENV

      - name: Act based on version change
        run: |
          if [ "$VERSION_CHANGED" = "true" ]; then
            echo "Proceed with actions for version change."
            # Add additional steps for version change (e.g., build, deployment)
          else
            echo "No version change detected. Skipping version-related steps."
          fi
